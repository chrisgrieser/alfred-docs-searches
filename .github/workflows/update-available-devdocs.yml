name: Update DevDocs Versions

on:
  # once a month (14:14 at the 14th of the month)
  schedule:
    - cron: "14 14 14 * *"

  # allow triggering manually
  workflow_dispatch: {}

permissions:
  contents: write

#â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

jobs:
  build:
    runs-on: macos-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "21.x"

      - name: Update Documentation Search Index
        run: |
          # INFO the script also updated the `info.plist` popup selection,
          # however we do not add those here as they complicate updates with
          # my local Alfred workflow. This auto-updating workflow is for now
          # only concerned with updating the keyword-slug-map.json file, and the
          # `info.plist` can be manually updated (since it will require an
          # update much less frequently anyway).
          node ./devdocs/update-available-devdocs.mjs
          git add ./.github/keyword-slug-map.json

          [[ -z "$(git diff --staged --name-only)" ]] && exit 0 # no update needed
          git commit -m "chore: Updated devdocs versions" --author="ðŸ¤– Automated GitHub Action<cron@job>"
          git push
